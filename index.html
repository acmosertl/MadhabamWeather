<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ | Madhabam Weather</title>
<style>
  body {
    font-family: 'Noto Sans Bengali', sans-serif;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(to bottom, #2b68b8, #b8e0ff);
    transition: background 1s ease;
  }
  .card {
    background: rgba(0,0,0,0.18);
    color: #fff;
    text-align: center;
    border-radius: 18px;
    padding: 20px;
    width: 340px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    backdrop-filter: blur(8px);
  }
  .title { font-size: 22px; font-weight: 700; margin: 5px 0; }
  .loc { font-size: 16px; margin-bottom: 5px; }
  .temp { font-size: 58px; font-weight: 800; margin: 8px 0; }
  .ico { font-size: 48px; text-shadow: 0 0 6px rgba(255,255,255,0.7); }
  .txt { font-size: 17px; line-height: 1.4; margin: 5px 0; }
  .extra { font-size: 15px; margin-top: 8px; }
  .forecast {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    gap: 8px; margin-top: 12px;
  }
  .day {
    background: rgba(255,255,255,0.18);
    border-radius: 12px;
    padding: 10px 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  }
  .day .ico { font-size: 28px; }
  .small { font-size: 14px; }
  
  html, body {
    height: auto !important;
    min-height: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: visible !important;
  }

  .weather-container {
    margin-top: 0 !important;
    padding-top: 10px !important;
  }

  iframe, #weatherFrame {
    height: auto !important;
    min-height: 100% !important;
    overflow: visible !important;
  }

  .weather-card {
    box-sizing: border-box;
    border-radius: 16px;
    padding: 10px 0;
  }
</style>
</head>
<body>
<div class="card" id="weatherCard">
  <div class="title">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ</div>
  <div class="loc" id="loc">‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶£‡¶Ø‡¶º ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
  <div class="temp" id="temp">--¬∞C</div>
  <div class="ico" id="ico">‚òÄÔ∏è</div>
  <div class="txt" id="now">‡¶è‡¶ñ‡¶®<br>--</div>
  <div class="extra" id="extra">--</div>
  <div class="forecast" id="forecast">‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
</div>

<script>
(async function(){
  const locEl=document.getElementById('loc'),
        tempEl=document.getElementById('temp'),
        icoEl=document.getElementById('ico'),
        nowEl=document.getElementById('now'),
        exEl=document.getElementById('extra'),
        fcEl=document.getElementById('forecast'),
        card=document.getElementById('weatherCard');
  
  const icons={0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",61:"üåßÔ∏è",63:"üå¶Ô∏è",65:"üåßÔ∏è",95:"‚õàÔ∏è",99:"üå©Ô∏è"};
  const desc={0:"‡¶Ü‡¶ï‡¶æ‡¶∂ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞",1:"‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶Æ‡ßá‡¶ò‡¶≤‡¶æ",2:"‡¶Æ‡ßá‡¶ò‡¶æ‡¶ö‡ßç‡¶õ‡¶®‡ßç‡¶®",3:"‡¶™‡ßÅ‡¶∞‡ßã‡¶™‡ßÅ‡¶∞‡¶ø ‡¶Æ‡ßá‡¶ò‡¶≤‡¶æ",61:"‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø",95:"‡¶¨‡¶ú‡ßç‡¶∞‡¶∏‡¶π ‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø",99:"‡¶ù‡¶°‡¶º‡ßã ‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø"};

  async function getLocation(){
    return new Promise((res)=>{
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(
          pos=>res({lat:pos.coords.latitude,lon:pos.coords.longitude,via:'gps'}),
          async ()=>{res(await ipFallback());},
          {timeout:6000}
        );
      }else res(ipFallback());
    });
  }

  async function ipFallback(){
    try{
      const r=await fetch("https://ipapi.co/json/");const d=await r.json();
      return {lat:d.latitude,lon:d.longitude,city:d.city||"Unknown",via:"ip"};
    }catch{return {lat:22.57,lon:88.36,city:"Kolkata",via:"fallback"}}
  }

  async function run(){
    const L=await getLocation();
    locEl.textContent=L.city||"Kolkata";
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${L.lat}&longitude=${L.lon}&current=temperature_2m,relative_humidity_2m,precipitation,weathercode,wind_speed_10m&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum&timezone=auto`;
    const r=await fetch(url);const d=await r.json();
    const c=d.current;const D=d.daily;const code=c.weathercode;
    
    const now=new Date();const sunrise=new Date(D.sunrise[0]);const sunset=new Date(D.sunset[0]);
    const night=(now<sunrise||now>sunset);
    document.body.style.background = night ? 'linear-gradient(to bottom, #0d1b3a, #2c3a52)' : 'linear-gradient(to bottom, #2b68b8, #b8e0ff)';
    
    tempEl.textContent=c.temperature_2m+"¬∞C";
    icoEl.textContent=icons[code]||"‚òÄÔ∏è";
    nowEl.innerHTML="‡¶è‡¶ñ‡¶®<br>"+(desc[code]||"‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ");
    exEl.textContent=`‡¶Ü‡¶∞‡ßç‡¶¶‡ßç‡¶∞‡¶§‡¶æ: ${c.relative_humidity_2m}% ‚Ä¢ ‡¶¨‡¶æ‡¶§‡¶æ‡¶∏: ${c.wind_speed_10m} km/h ‚Ä¢ ‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø: ${c.precipitation} mm`;
    
    let html="";
    for(let i=0;i<7;i++){
      const day=i===0?"‡¶Ü‡¶ú":new Date(D.time[i]).toLocaleDateString('bn-BD',{weekday:'short'});
      html+=`<div class="day"><div class="ico">${icons[D.weathercode[i]]||"‚òÄÔ∏è"}</div>${day}<br><span class="small">${D.temperature_2m_max[i].toFixed(1)}¬∞ / ${D.temperature_2m_min[i].toFixed(1)}¬∞</span></div>`;
    }
    fcEl.innerHTML=html;
  }
  run();
})();
</script>
</body>
</html>
